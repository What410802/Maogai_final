<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<title>毛概第三组汇报</title>
		<link rel="icon" href="favicon.ico">
		<link rel="stylesheet" href="../css/impress-common.css"/>
		<link rel="stylesheet" href="../libs/csshake/csshake.css"/>
		<link rel="stylesheet" href="../css/utility.css"/>
		<script src="../libs/d3.v7/d3.v7.js"></script>
		<script src="../libs/plotly.js-3.3.0/plotly.js"></script>
	</head>
	<body class="strict-impress-parent impress-not-supported" style="font-family: 'Noto Serif CJK SC'; ">
		<div class="its-impress-son">
			<p>This browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
		</div>
		<div id="impress" data-width="1920" data-height="1080" data-transition-duration="750" style="font-size: xx-large;">

			<div class="step beg-step" data-x="0" data-y="0" style="
				width: 1920px; height: 1080px;
				background: linear-gradient(rgb(255, 220, 197), white);
				display: flex; align-items: center; justify-content: center;
			">
				<div style="text-align: center; scale: 1;">
					<hgroup>
						<h1>《中国的奇迹》阅读汇报</h1>
						<h3 style="text-align: right;">——跨世纪的腾飞之路</h3>
					</hgroup>
					<p>小组成员：成员一、成员二、……<br>
					主讲人：主讲人 abcd</p>
				</div>
			</div>

			<div class="step" data-rel-y="-1080">
				<figure>
					<img src="images/tongma.jpg"/>
					<figcaption style="text-align: center;">图1&#x3000;铜马</figcaption>
				</figure>
			</div>

			<div id="content-page" class="step" data-x="1920" data-y="0" data-z="0" style="width: max-content;">
				<h1>主要内容</h1>
				<ol start="0">
					<li id="content-it0">总述</li>
					<li id="content-it1">改革号角</li>
					<li id="content-it2">改革洪流</li>
					<li id="content-it3">辉煌成就</li>
				</ol>
			</div>
			<div class="step ret-step" data-x="1920" data-y="0" data-z="0" data-transition-duration="0" mygo="content-it0"></div> <!-- Same as `content-page` -->

			<div class="step" data-z="3840">
				<div id="popu"></div>
				<script>
					d3.csv('data/gapminderDataFiveYear.csv').then(function (data) {
						// Create a lookup table to sort and regroup the columns of data,
						// first by year, then by continent:
						let lookup = {};
						function getData(year, continent) {
							let byYear, trace;
							if (!(byYear = lookup[year])) {
								byYear = lookup[year] = {};
							}
							// If a container for this year + continent doesn't exist yet,
							// then create one:
							if (!(trace = byYear[continent])) {
								trace = byYear[continent] = {
									x: [],
									y: [],
									id: [],
									text: [],
									marker: {size: []}
								};
							}
							return trace;
						}

						// Go through each row, get the right trace, and append the data:
						for (const datum of data) {
							const trace = getData(datum.year, datum.continent); // What you get is NOT a copy of `data` but a ref of it
							trace.text.push(datum.country);
							trace.id.push(datum.country);
							trace.x.push(datum.lifeExp);
							trace.y.push(datum.gdpPercap);
							trace.marker.size.push(datum.pop);
						}

						// Get the group names:
						const years = Object.keys(lookup);
						// In this case, every year includes every continent, so we
						// can just infer the continents from the *first* year:
						const firstYear = lookup[years[0]];
						const continents = Object.keys(firstYear);

						// Create the main traces, one for each continent:
						const traces = continents.map(continent => {
							const data = firstYear[continent];
							// One small note. We're creating a single trace here, to which
							// the frames will pass data for the different years. It's
							// subtle, but to avoid data reference problems, we'll slice 
							// the arrays to ensure we never write any new data into our
							// lookup table:
							return {
								name: continent,
								x: data.x.slice(),
								y: data.y.slice(),
								id: data.id.slice(),
								text: data.text.slice(),
								mode: 'markers',
								marker: {
									size: data.marker.size.slice(),
									sizemode: 'area',
									sizeref: 200000
								}
							};
						});

						// Create a frame for each year. Frames are effectively just
						// traces, except they don't need to contain the *full* trace
						// definition (for example, appearance). The frames just need
						// the parts the traces that change (here, the data).
						const frames = years.map(year => ({
							name: year,
							data: continents.map(continent => getData(year, continent))
						}));
						
						// Now create slider steps, one for each frame. The slider
						// executes a plotly.js API command (here, Plotly.animate).
						// In this example, we'll animate to one of the named frames
						// created in the above loop.
						const sliderSteps = years.map(year => ({
							method: 'animate',
							label: year,
							args: [[year], {
								mode: 'immediate',
								transition: {duration: 300},
								frame: {duration: 300, redraw: false},
							}]
						}));
						
						const layout = {
							width: 1920/1.414,
							height: 1080/1.2,
							title: {
								text: `世界主要经济体数据`
							},
							xaxis: {
								title: {
									text: `预期寿命（Life Expectancy）/岁`
								},
								range: [30, 85]
							},
							yaxis: {
								title: {
									text: `人均GDP（GDP per Capita）/$`
								},
								type: 'log'
							},
							hovermode: 'closest',
							// We'll use updatemenus (whose functionality includes menus as
							// well as buttons) to create a play button and a pause button.
							// The play button works by passing `null`, which indicates that
							// Plotly should animate all frames. The pause button works by
							// passing `[null]`, which indicates we'd like to interrupt any
							// currently running animations with a new list of frames. Here
							// The new list of frames is empty, so it halts the animation.
							updatemenus: [{
								x: 0,
								y: 0,
								yanchor: 'top',
								xanchor: 'left',
								showactive: false,
								direction: 'left',
								type: 'buttons',
								pad: {t: 87, r: 10},
								buttons: [
									{
										method: 'animate',
										args: [null, {
											mode: 'immediate',
											fromcurrent: true,
											transition: {duration: 750},
											frame: {duration: 750, redraw: false}
										}],
										label: `播放▶️`
									},
									{
										method: 'animate',
										args: [[null], {
											mode: 'immediate',
											transition: {duration: 0},
											frame: {duration: 0, redraw: false}
										}],
										label: `暂停⏸️`
									}
								]
							}],
							// Finally, add the slider and use `pad` to position it
							// nicely next to the buttons.
							sliders: [{
								pad: {l: 130, t: 55},
								currentvalue: {
									visible: true,
									prefix: `年份：`,
									xanchor: 'right',
									font: {size: 20, color: '#666'}
								},
								steps: sliderSteps
							}]
						};
						
						// Create the plot:
						Plotly.newPlot(`popu`, {
							data: traces,
							layout: layout,
							// config: {showSendToCloud:true},
							frames: frames,
						}).catch(function (err) {
							console.log(err);
						});
					});
					console.log(`Loaded figure "popu"`);
				</script>
			</div>

			<div class="step ret-step" data-x="1920" data-y="0" data-z="0" mygo="content-it1"></div> <!-- Same as `content-page` -->

			<div class="step" data-x="3840" data-y="0" data-z="0" style="width: max-content;">
				<h1>第一篇章：改革号角</h1>
				<ul>
					<li><b>核心：</b></li>
				</ul>
			</div>

			<div class="step ret-step" data-x="1920" data-y="0" data-z="0" mygo="content-it2"></div> <!-- Same as `content-page` -->

			<div class="step" data-x="5760" data-y="0" data-z="0" style="width: max-content;">
				<h1>第二篇章：改革洪流</h1>
				<ul>
					<li><b>核心：</b>比较优势战略</li>
					<li>改革序幕：微观突破</li>
				</ul>
			</div>

			<div class="step ret-step" data-x="1920" data-y="0" data-z="0" mygo="content-it3"></div> <!-- Same as `content-page` -->

			<div class="step" data-x="7680" data-y="0" data-z="0" style="width: max-content;">
				<h1>第三篇章：辉煌成就</h1>
				<ul>
					<li></li>
				</ul>
			</div>

			<div class="step" data-x="9600" data-y="0" data-z="0">
				<h1>感谢观看！</h1>
				<p>第三小组全体成员</p>
			</div>

		</div>

		<script src="../js/impress.js"></script>
		<script>
			// window.impress || document.write('<script src="https://cdn.jsdelivr.net/gh/impress/impress.js@2.0.0/js/impress.js">\x3C/script>');
			impress().init();
		</script>
		<script src="../js/utility.js"></script>
	</body>
</html>